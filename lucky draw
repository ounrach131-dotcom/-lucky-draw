<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Year End Party Lucky Draw</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts: Kantumruy Pro -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: "Kantumruy Pro", sans-serif;
        }
        
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        /* Animations */
        @keyframes bounce-subtle {
            0%, 100% { transform: translate(-50%, -10px); }
            50% { transform: translate(-50%, 0); }
        }
        .animate-bounce-subtle {
            animation: bounce-subtle 2s infinite ease-in-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slideIn {
            animation: slideIn 0.3s ease-out forwards;
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-popIn {
            animation: popIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        .animate-blob {
            animation: blob 7s infinite;
        }
        .animation-delay-2000 { animation-delay: 2s; }
        .animation-delay-4000 { animation-delay: 4s; }

        .glass-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Wheel Shadow */
        .wheel-container {
            border-radius: 50%;
            box-shadow: 0 0 40px rgba(0,0,0,0.6), inset 0 0 25px rgba(0,0,0,0.6);
            background: rgba(0,0,0,0.3);
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-[#1e1b4b] via-[#4c1d95] to-[#db2777] text-white selection:bg-pink-500 selection:text-white overflow-hidden relative">

    <!-- Background Blobs -->
    <div class="fixed top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-0">
        <div class="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-purple-500 rounded-full mix-blend-multiply filter blur-[128px] opacity-40 animate-blob"></div>
        <div class="absolute top-[-10%] right-[-10%] w-[500px] h-[500px] bg-pink-500 rounded-full mix-blend-multiply filter blur-[128px] opacity-40 animate-blob animation-delay-2000"></div>
        <div class="absolute bottom-[-10%] left-[20%] w-[500px] h-[500px] bg-indigo-500 rounded-full mix-blend-multiply filter blur-[128px] opacity-40 animate-blob animation-delay-4000"></div>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="fixed top-5 left-1/2 transform -translate-x-1/2 z-[100] hidden transition-all duration-300">
        <div id="notification-content" class="flex items-center gap-3 px-6 py-4 rounded-xl shadow-2xl border backdrop-blur-md">
            <i id="notification-icon" data-lucide="alert-circle"></i>
            <span id="notification-message" class="font-bold">Message</span>
        </div>
    </div>

    <!-- Reset Modal -->
    <div id="reset-modal" class="fixed inset-0 bg-black/60 backdrop-blur-md z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl p-6 max-w-sm w-full animate-slideIn text-white">
            <div class="flex justify-center mb-4 text-red-400">
                <i data-lucide="alert-circle" width="48" height="48"></i>
            </div>
            <h3 class="text-xl font-bold text-center mb-2">á”á‰áŸ’á‡á¶á€áŸ‹á€á¶áš Reset?</h3>
            <p class="text-white/70 text-center mb-6 text-sm">
                á‘á·á“áŸ’á“á“áŸá™á¢áŸ’á“á€áˆáŸ’á“áŸ‡á‘á¶áŸ†á„á¢áŸáŸ‹á“á¹á„ááŸ’ášá¼áœá›á»á”á…áŸ„á›áŸ” áá¾á¢áŸ’á“á€á…á„áŸ‹á”á“áŸ’áá‘áŸ?
            </p>
            <div class="flex gap-3">
                <button onclick="closeResetModal()" class="flex-1 py-3 bg-white/10 hover:bg-white/20 border border-white/10 text-white font-bold rounded-xl transition-all">
                    á‘áŸ (Cancel)
                </button>
                <button onclick="confirmReset()" class="flex-1 py-3 bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white font-bold rounded-xl transition-all shadow-lg shadow-red-500/30">
                    á”á¶á‘/á…á¶áŸ (Reset)
                </button>
            </div>
        </div>
    </div>

    <!-- Big Winner Reveal Modal -->
    <div id="winner-modal" class="fixed inset-0 bg-black/80 backdrop-blur-xl z-[150] hidden flex items-center justify-center p-4">
        <div id="winner-modal-content" class="bg-gradient-to-b from-white/10 to-white/5 border border-white/20 rounded-[3rem] p-12 max-w-4xl w-full text-center shadow-[0_0_100px_rgba(236,72,153,0.3)]">
            <h2 class="text-2xl md:text-3xl text-pink-400 font-bold mb-6 tracking-widest uppercase flex items-center justify-center gap-3">
                <i data-lucide="sparkles" class="text-yellow-300"></i>
                áŸá¼á˜á¢á”á¢ášáŸá¶á‘áš!
                <i data-lucide="sparkles" class="text-yellow-300"></i>
            </h2>
            
            <div id="big-winner-name" class="text-6xl md:text-8xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-300 via-white to-purple-300 drop-shadow-[0_0_20px_rgba(255,255,255,0.5)] mb-6 tracking-wider">
                Winner Name
            </div>
            
            <div id="big-winner-dept" class="inline-block px-8 py-2 bg-emerald-500/20 border border-emerald-500/30 rounded-full text-emerald-300 text-3xl font-bold mb-10 shadow-[0_0_15px_rgba(16,185,129,0.3)]">
                Department
            </div>
            
            <div class="flex flex-col items-center justify-center gap-4 text-2xl text-white/80 bg-black/30 p-6 rounded-3xl border border-white/10 w-fit mx-auto">
                <span class="text-lg uppercase tracking-widest text-white/50">áˆáŸ’á“áŸ‡ášá„áŸ’áœá¶á“áŸ‹</span>
                <div class="flex items-center gap-4">
                    <span id="big-winner-prize-img" class="text-6xl drop-shadow-lg">ğŸ</span>
                    <span id="big-winner-prize-name" class="font-black text-4xl text-yellow-300 drop-shadow-md">Prize Name</span>
                </div>
            </div>
            
            <button onclick="closeWinnerModal()" class="mt-12 px-12 py-4 bg-white/10 hover:bg-white/20 border border-white/20 text-white rounded-full font-bold text-xl transition-all active:scale-95 shadow-lg">
                á”á·á‘ (Close)
            </button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container mx-auto p-4 lg:p-8 max-w-7xl relative z-10 h-screen flex flex-col">
        
        <!-- Header -->
        <header class="glass-panel rounded-2xl shadow-xl p-6 mb-6 flex flex-col md:flex-row justify-between items-center gap-4 flex-shrink-0">
            <div class="flex items-center gap-4">
                <div class="bg-gradient-to-br from-pink-500 to-purple-600 p-3 rounded-xl shadow-lg shadow-purple-500/30">
                    <i data-lucide="trophy" class="text-white" width="32" height="32"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-white uppercase drop-shadow-md">
                        YEAR END PARTY LUCKY DRAW
                    </h1>
                    <p class="text-white/80 text-sm font-medium">á€á˜áŸ’á˜áœá·á’á¸á…á¶á”áŸ‹á†áŸ’á“áŸ„áá•áŸ’áŸá„áŸáŸ†áá¶á„</p>
                    <p class="text-white/60 text-xs mt-1 uppercase tracking-wide font-light">
                        BROUGHT TO YOU BY: UC HOME, LESSO, HONG KONG restaurants, LUK HOT POT
                    </p>
                </div>
            </div>
            
            <div class="flex gap-4 items-center">
                <div class="flex items-center gap-2 bg-black/20 px-4 py-2 rounded-lg border border-white/10">
                    <i data-lucide="users" class="text-pink-400" width="18" height="18"></i>
                    <span class="text-white/80 font-medium">á¢áŸ’á“á€á›áŸá„: <span id="participant-count" class="text-white font-bold">0</span> á“á¶á€áŸ‹</span>
                </div>
                <button onclick="openResetModal()" class="flex items-center gap-2 px-5 py-2.5 bg-white/10 hover:bg-white/20 text-white font-medium border border-white/20 rounded-lg transition-all shadow-sm cursor-pointer active:scale-95">
                    <i data-lucide="rotate-ccw" width="16" height="16"></i>
                    Reset
                </button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 flex-1 min-h-0">
            
            <!-- Left: Prize List -->
            <div class="lg:col-span-3 order-2 lg:order-1 glass-panel rounded-2xl shadow-xl flex flex-col overflow-hidden h-full max-h-[600px] lg:max-h-none">
                <div class="p-4 border-b border-white/10 bg-white/5 flex-shrink-0">
                    <h2 class="text-lg font-bold flex items-center gap-2 text-white">
                        <i data-lucide="gift" class="text-pink-400"></i>
                        ášá„áŸ’áœá¶á“áŸ‹ (Prizes)
                    </h2>
                </div>
                <div id="prize-list" class="flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2">
                    <!-- Prizes will be injected here -->
                </div>
            </div>

            <!-- Center: Main Stage -->
            <div class="lg:col-span-6 flex flex-col gap-4 order-1 lg:order-2 h-full justify-center">
                <div class="glass-panel rounded-3xl p-6 shadow-2xl flex flex-col items-center justify-center text-center relative overflow-hidden">
                    
                    <div class="absolute inset-0 bg-gradient-to-tr from-white/5 to-transparent pointer-events-none"></div>

                    <!-- Current Prize -->
                    <div class="relative z-10 mb-2 flex items-center gap-4">
                        <div id="current-prize-img" class="text-5xl filter drop-shadow-xl animate-bounce-subtle">â“</div>
                        <div class="text-left">
                            <div class="inline-block px-3 py-0.5 bg-green-500/20 backdrop-blur-md rounded-full text-green-300 text-[10px] font-bold uppercase tracking-wider border border-green-500/30 mb-1">
                                ášá„áŸ’áœá¶á“áŸ‹á”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“
                            </div>
                            <div id="current-prize-name" class="text-2xl font-bold text-white drop-shadow-md">áŸá¼á˜á‡áŸ’ášá¾áŸášá¾áŸášá„áŸ’áœá¶á“áŸ‹</div>
                        </div>
                    </div>

                    <!-- Spinning Wheel Container -->
                    <div class="relative z-10 w-full flex flex-col items-center mt-2">
                        <!-- á”á„áŸ’á€á¾á“á‘áŸ†á áŸ† max-w-[480px] áŠá¾á˜áŸ’á”á¸á²áŸ’á™á€á„áœá·á›á’áŸ†á‡á¶á„á˜á»á“ -->
                        <div class="relative flex justify-center items-center w-full max-w-[480px] aspect-square mx-auto mb-4">
                            <!-- Pointer -->
                            <div class="absolute -top-6 left-1/2 -translate-x-1/2 z-20 filter drop-shadow-[0_4px_4px_rgba(0,0,0,0.5)]">
                                <svg width="64" height="64" viewBox="0 0 24 24" fill="#f43f5e" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 22L2 6h20L12 22z"/>
                                </svg>
                            </div>
                            <!-- Wheel Canvas (á‘áŸ†á áŸ†á‚á»áá—á¶á–ááŸ’á–áŸáŸ‹ 800x800) -->
                            <div class="wheel-container w-full h-full p-1.5 border-[5px] border-white/20">
                                <canvas id="wheel-canvas" width="800" height="800" class="w-full h-full rounded-full"></canvas>
                            </div>
                        </div>

                        <!-- Winner Reveal Box -->
                        <div id="winner-reveal" class="h-[70px] w-full flex flex-col items-center justify-center opacity-100 transition-opacity duration-300">
                            <div id="display-name" class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-300 via-white to-purple-300 drop-shadow-[0_0_10px_rgba(255,255,255,0.5)]">
                                áŸá¼á˜á…á»á… SPIN
                            </div>
                            <div id="winner-dept" class="mt-2 text-emerald-300 font-bold text-lg animate-pulse hidden bg-black/50 px-4 py-0.5 rounded-full border border-emerald-500/30">
                                Dept
                            </div>
                        </div>
                    </div>

                    <!-- Draw Button -->
                    <button id="draw-btn" onclick="handleDraw()" class="relative z-10 mt-2 flex items-center gap-3 px-12 py-4 rounded-full text-xl font-black tracking-widest text-white shadow-xl transition-all hover:scale-105 active:scale-95 cursor-pointer border border-white/20 bg-gradient-to-r from-pink-500 to-violet-600 hover:from-pink-400 hover:to-violet-500 hover:shadow-pink-500/50">
                        <i data-lucide="dices" width="28" height="28" class="animate-pulse"></i>
                        SPIN !
                    </button>
                </div>
            </div>

            <!-- Right: Winners -->
            <div class="lg:col-span-3 order-3 glass-panel rounded-2xl shadow-xl flex flex-col overflow-hidden h-full max-h-[600px] lg:max-h-none">
                <div class="p-4 border-b border-white/10 bg-white/5 flex-shrink-0">
                    <h2 class="text-lg font-bold flex items-center gap-2 text-white">
                        <i data-lucide="trophy" class="text-yellow-400"></i>
                        á¢áŸ’á“á€áˆáŸ’á“áŸ‡ (Winners)
                    </h2>
                </div>
                <div id="winners-list" class="flex-1 overflow-y-auto custom-scrollbar p-3 space-y-3">
                    <div class="h-full flex flex-col items-center justify-center text-white/40">
                        <p class="text-sm">á˜á·á“á‘á¶á“áŸ‹á˜á¶á“á¢áŸ’á“á€áˆáŸ’á“áŸ‡</p>
                    </div>
                </div>
                <div class="p-3 bg-white/5 border-t border-white/10 text-center flex-shrink-0">
                    <div class="text-xs text-white/50 font-medium">
                        á¢áŸ’á“á€áˆáŸ’á“áŸ‡áŸášá»á”: <span id="total-winners">0</span> á“á¶á€áŸ‹
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Logic Script -->
    <script>
        // Data
        const initialPrizes = [
            { id: 1, name: 'Lucky Horse', total: 5, image: 'ğŸ´' },
            { id: 2, name: 'Bed Sheet', total: 2, image: 'ğŸ›ï¸' },
            { id: 3, name: 'Basin clearance', total: 1, image: 'ğŸ¥£' },
            { id: 4, name: 'Hotpot set 18$', total: 2, image: 'ğŸ²' },
            { id: 5, name: 'Hotpot set 28$', total: 2, image: 'ğŸ¥˜' },
            { id: 6, name: 'Hotpot set 58$', total: 1, image: 'ğŸ”¥' },
            { id: 7, name: 'Toshiba Fan', total: 1, image: 'ğŸ’¨' },
            { id: 8, name: '$10.00', total: 3, image: 'ğŸ’µ' },
            { id: 9, name: '$20.00', total: 2, image: 'ğŸ’°' },
            { id: 10, name: '$30.00', total: 1, image: 'ğŸ’' },
        ];

        const initialParticipants = [
            // UC home
            { id: 'u1', name: 'Sarin', dept: 'UC home' },
            { id: 'u2', name: 'Kimteang', dept: 'UC home' },
            { id: 'u3', name: 'Vanndy', dept: 'UC home' },
            { id: 'u4', name: 'Theavy', dept: 'UC home' },
            { id: 'u5', name: 'Kimeay', dept: 'UC home' },
            { id: 'u6', name: 'Ehong', dept: 'UC home' },
            { id: 'u7', name: 'Hov', dept: 'UC home' },
            { id: 'u8', name: 'Nin', dept: 'UC home' },
            { id: 'u9', name: 'Chantrea', dept: 'UC home' },
            { id: 'u10', name: 'Chet', dept: 'UC home' },
            { id: 'u11', name: 'Roth', dept: 'UC home' },
            { id: 'u12', name: 'Meng EY', dept: 'UC home' },
            // Lesso
            { id: 'l1', name: 'Samouern', dept: 'Lesso' },
            { id: 'l2', name: 'Milo', dept: 'Lesso' },
            { id: 'l3', name: 'Horng', dept: 'Lesso' },
            { id: 'l4', name: 'Channak', dept: 'Lesso' },
            // HK
            { id: 'h1', name: 'Auntie', dept: 'HK' },
            { id: 'h2', name: 'Then', dept: 'HK' },
            { id: 'h3', name: 'Thorng', dept: 'HK' },
            { id: 'h4', name: 'Sokun', dept: 'HK' },
            { id: 'h5', name: 'Thin', dept: 'HK' },
            { id: 'h6', name: 'Ey Ey', dept: 'HK' },
            { id: 'h7', name: 'Houy', dept: 'HK' },
            { id: 'h8', name: 'Sok Cheng', dept: 'HK' },
            { id: 'h9', name: 'Nich', dept: 'HK' },
            // Luk Hotpot
            { id: 'luk1', name: 'Li Yong', dept: 'Luk Hotpot' },
            { id: 'luk2', name: 'Yath Sophanna', dept: 'Luk Hotpot' },
            { id: 'luk3', name: 'Yath Socheat', dept: 'Luk Hotpot' },
            { id: 'luk4', name: 'Yin Hieng', dept: 'Luk Hotpot' },
            { id: 'luk5', name: 'Peut Kimhong', dept: 'Luk Hotpot' },
            { id: 'luk6', name: 'Chea Teang', dept: 'Luk Hotpot' },
            { id: 'luk7', name: 'Chea Lai Heang', dept: 'Luk Hotpot' },
            { id: 'luk8', name: 'Vong Srey Phut', dept: 'Luk Hotpot' },
            { id: 'luk9', name: 'Sen Sovannarey', dept: 'Luk Hotpot' },
            { id: 'luk10', name: 'Chov Sevyin', dept: 'Luk Hotpot' },
            { id: 'luk11', name: 'Me SreyPov', dept: 'Luk Hotpot' },
            { id: 'luk12', name: 'Loeur koemlyn', dept: 'Luk Hotpot' },
            { id: 'luk13', name: 'Va Davy', dept: 'Luk Hotpot' },
            { id: 'luk14', name: 'My Manh', dept: 'Luk Hotpot' },
            { id: 'luk15', name: 'Orn Muoycheang', dept: 'Luk Hotpot' },
            { id: 'luk16', name: 'Sin Sopheak', dept: 'Luk Hotpot' },
            { id: 'luk17', name: 'Chhean nak', dept: 'Luk Hotpot' },
            { id: 'luk18', name: 'Terk Sa Ran', dept: 'Luk Hotpot' },
            { id: 'luk19', name: 'Pin Molyny', dept: 'Luk Hotpot' },
            { id: 'luk20', name: 'Mean Kim Sok', dept: 'Luk Hotpot' },
            { id: 'luk21', name: 'Rith Piseth', dept: 'Luk Hotpot' },
            { id: 'luk22', name: 'Khuneung Theany', dept: 'Luk Hotpot' },
            { id: 'luk23', name: 'Ly Srithou', dept: 'Luk Hotpot' },
            { id: 'luk24', name: 'Poeut Kimhak', dept: 'Luk Hotpot' },
            { id: 'luk25', name: 'LY Samnang', dept: 'Luk Hotpot' },
            { id: 'luk26', name: 'Ngin Heang', dept: 'Luk Hotpot' },
            { id: 'luk27', name: 'Morm Ratha', dept: 'Luk Hotpot' },
            { id: 'luk28', name: 'Yeb Chhuylong', dept: 'Luk Hotpot' },
            { id: 'luk29', name: 'Oeng Khity', dept: 'Luk Hotpot' },
            { id: 'luk30', name: 'Navy Savorn', dept: 'Luk Hotpot' },
            { id: 'luk31', name: 'Phn Sreyphyn', dept: 'Luk Hotpot' },
            { id: 'luk32', name: 'Wang Lipeng', dept: 'Luk Hotpot' },
        ];

        // State
        let participants = [...initialParticipants];
        let prizes = [...initialPrizes];
        let winners = [];
        let selectedPrizeId = initialPrizes[0].id;
        let isSpinning = false;
        let currentRotation = 0;

        // Elements
        const prizeListEl = document.getElementById('prize-list');
        const winnersListEl = document.getElementById('winners-list');
        const drawBtn = document.getElementById('draw-btn');
        const wheelCanvas = document.getElementById('wheel-canvas');
        const ctx = wheelCanvas.getContext('2d');
        const winnerDeptEl = document.getElementById('winner-dept');
        const currentPrizeImgEl = document.getElementById('current-prize-img');
        const currentPrizeNameEl = document.getElementById('current-prize-name');
        const participantCountEl = document.getElementById('participant-count');
        const totalWinnersEl = document.getElementById('total-winners');
        const displayNameEl = document.getElementById('display-name');
        
        // Modal & Notification
        const resetModal = document.getElementById('reset-modal');
        const notificationEl = document.getElementById('notification');
        const notifContent = document.getElementById('notification-content');
        const notifMessage = document.getElementById('notification-message');

        // Big Winner Modal Elements
        const winnerModal = document.getElementById('winner-modal');
        const winnerModalContent = document.getElementById('winner-modal-content');
        const bigWinnerName = document.getElementById('big-winner-name');
        const bigWinnerDept = document.getElementById('big-winner-dept');
        const bigWinnerPrizeImg = document.getElementById('big-winner-prize-img');
        const bigWinnerPrizeName = document.getElementById('big-winner-prize-name');

        const wheelColors = ['#ec4899', '#8b5cf6', '#0ea5e9']; // Pink, Purple, Cyan

        // Initial Render
        renderPrizes();
        updateDisplay();
        drawWheel();
        lucide.createIcons();

        // --- Logic Functions ---

        function getRemainingQty(prizeId) {
            const wonCount = winners.filter(w => w.prize.id === prizeId).length;
            const prize = prizes.find(p => p.id === prizeId);
            return prize.total - wonCount;
        }

        function renderPrizes() {
            prizeListEl.innerHTML = '';
            prizes.forEach(prize => {
                const remaining = getRemainingQty(prize.id);
                const isSelected = selectedPrizeId === prize.id;
                const isOut = remaining === 0;

                const btn = document.createElement('button');
                btn.className = `w-full text-left p-3 rounded-xl transition-all border relative overflow-hidden group ${
                    isSelected 
                        ? 'bg-gradient-to-r from-green-500/80 to-emerald-600/80 border-green-400/50 shadow-lg shadow-green-500/20 transform scale-[1.02]' 
                        : isOut 
                          ? 'bg-black/20 border-transparent opacity-50 cursor-not-allowed'
                          : 'bg-white/5 border-transparent hover:bg-white/10 hover:border-white/10'
                }`;
                btn.onclick = () => {
                    if (!isOut && !isSpinning) {
                        selectedPrizeId = prize.id;
                        renderPrizes();
                        updateDisplay();
                    }
                };

                btn.innerHTML = `
                    <div class="flex justify-between items-center mb-1 relative z-10">
                        <span class="text-2xl filter drop-shadow-sm">${prize.image}</span>
                        <span class="text-xs font-bold px-2 py-1 rounded-full backdrop-blur-sm ${
                            remaining > 0 ? 'bg-white/20 text-white' : 'bg-red-500/40 text-red-100'
                        }">
                            á…áŸ†á“á½á“: ${remaining}
                        </span>
                    </div>
                    <div class="font-medium text-sm truncate relative z-10 ${isSelected ? 'text-white font-bold' : 'text-white/80 group-hover:text-white'}">
                        ${prize.name}
                    </div>
                `;
                prizeListEl.appendChild(btn);
            });
        }

        function updateDisplay() {
            const currentPrize = prizes.find(p => p.id === selectedPrizeId);
            if (currentPrize) {
                currentPrizeImgEl.textContent = currentPrize.image;
                currentPrizeNameEl.textContent = currentPrize.name;
            }
            participantCountEl.textContent = participants.length;
            totalWinnersEl.textContent = winners.length;
        }

        function drawWheel() {
            ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);
            const numSlices = participants.length;
            const centerX = 400; // á€ááŸ’áá¶á› Canvas (800 / 2)
            const centerY = 400; // á€ááŸ’áá¶á› Canvas (800 / 2)
            const radius = 390;  // á€á¶áŸ†ášá„áŸ’áœá„áŸ‹ (Canvas á‘áŸ†á áŸ†á’áŸ†á‡á¶á„á˜á»á“)
            
            if (numSlices === 0) {
                // Empty Wheel
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
                ctx.fillStyle = "rgba(0,0,0,0.5)";
                ctx.fill();
                return;
            }

            const sliceAngle = (2 * Math.PI) / numSlices;
            
            // áŸá˜áŸ’ášá½á›á‘áŸ†á áŸ† Font á²áŸ’á™áŸá¶á€áŸá˜á“á¹á„á€á„áœá·á›á’áŸ†
            let fontSize = 28;
            if (numSlices > 40) fontSize = 18;
            else if (numSlices > 20) fontSize = 22;

            for (let i = 0; i < numSlices; i++) {
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                // Draw starting from -90 degrees (top)
                ctx.arc(centerX, centerY, radius, i * sliceAngle - Math.PI/2, (i + 1) * sliceAngle - Math.PI/2);
                ctx.closePath();
                ctx.fillStyle = wheelColors[i % wheelColors.length];
                ctx.fill();
                ctx.lineWidth = 2;
                ctx.strokeStyle = "rgba(255,255,255,0.4)";
                ctx.stroke();

                // Draw Text
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(i * sliceAngle + sliceAngle / 2 - Math.PI/2);
                ctx.textAlign = "right";
                ctx.fillStyle = "#ffffff";
                ctx.font = `bold ${fontSize}px 'Kantumruy Pro', sans-serif`;
                
                let name = participants[i].name;
                if(name.length > 18) name = name.substring(0, 18) + '...';
                
                // Add slight shadow for readability
                ctx.shadowColor = "rgba(0,0,0,0.6)";
                ctx.shadowBlur = 4;
                ctx.shadowOffsetX = 1;
                ctx.shadowOffsetY = 1;
                
                ctx.fillText(name, radius - 30, 8); // ášáŸ†á€á·á›á¢á€áŸ’áŸášá…á¼á›á€áŸ’á“á»á„á”á“áŸ’áá·á…
                ctx.restore();
            }

            // Center inner circle
            ctx.beginPath();
            ctx.arc(centerX, centerY, 40, 0, 2 * Math.PI); // á–á„áŸ’ášá¸á€ášá„áŸ’áœá„áŸ‹á€ááŸ’áá¶á›
            ctx.fillStyle = "#1e1b4b";
            ctx.fill();
            ctx.lineWidth = 4;
            ctx.strokeStyle = "#ec4899";
            ctx.stroke();
        }

        function renderWinners() {
            winnersListEl.innerHTML = '';
            if (winners.length === 0) {
                winnersListEl.innerHTML = `
                    <div class="h-full flex flex-col items-center justify-center text-white/40">
                        <p class="text-sm">á˜á·á“á‘á¶á“áŸ‹á˜á¶á“á¢áŸ’á“á€áˆáŸ’á“áŸ‡</p>
                    </div>`;
                return;
            }

            // Show latest first
            [...winners].forEach((winner, index) => {
                const div = document.createElement('div');
                div.className = 'bg-white/5 p-3 rounded-xl border border-white/10 shadow-sm flex items-center gap-3 animate-slideIn hover:bg-white/10 transition-colors';
                div.innerHTML = `
                    <div class="bg-gradient-to-br from-blue-500 to-cyan-500 text-white font-bold w-10 h-10 rounded-lg flex items-center justify-center text-sm shadow-md">
                        ${winners.length - index}
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="font-bold text-white truncate">${winner.name}</div>
                        <div class="text-xs text-white/60 flex justify-between mt-0.5">
                            <span>${winner.dept}</span>
                            <span class="text-yellow-300 font-medium truncate max-w-[80px]">${winner.prize.name}</span>
                        </div>
                    </div>
                `;
                winnersListEl.prepend(div);
            });
        }

        function determineWinnerLogic() {
            let winner;

            // =========================================================================
            // --- RIGGED LOGIC (á€á¶ášá€áŸ†áááŸ‹á¢áŸ’á“á€áˆáŸ’á“áŸ‡á‘á»á€á˜á»á“) ---
            // á”á‰áŸ’á‡á¸áˆáŸ’á˜áŸ„áŸ‡á¢áŸ’á“á€áŠáŸ‚á›ááŸ’ášá¼áœáˆáŸ’á“áŸ‡ášá„áŸ’áœá¶á“áŸ‹á‡á¶á€áŸ‹á›á¶á€áŸ‹áŸ–
            // 1. Bed Sheet (áŸ¢ ášá„áŸ’áœá¶á“áŸ‹)     : Kimteang (u2) á“á·á„ Roth (u11)
            // 2. Hotpot set 28$ (áŸ¡ ášá„áŸ’áœá¶á“áŸ‹): Vanndy (u3)
            // 3. Toshiba Fan (áŸ¡ ášá„áŸ’áœá¶á“áŸ‹)   : Ehong (u6)
            // 4. $10.00 (áŸ£ ášá„áŸ’áœá¶á“áŸ‹)        : Kimeay (u5), Theavy (u4), á“á·á„ Hov (u7)
            // 5. $20.00 (áŸ¢ ášá„áŸ’áœá¶á“áŸ‹)        : Samouern (l1) á“á·á„ Horng (l3)
            // 6. $30.00 (áŸ¡ ášá„áŸ’áœá¶á“áŸ‹)        : Nin (u8)
            // 
            // á…áŸ†áá¶áŸ†áŸ– ášá„áŸ’áœá¶á“áŸ‹á•áŸ’áŸáŸá„áŸ—á‘áŸ€áá€áŸ’ášáŸ…á–á¸á“áŸáŸ‡ á“á¹á„ááŸ’ášá¼áœá…á¶á”áŸ‹áŠáŸ„á™á…áŸƒáŠá“áŸ’á™áŸá˜áŸ’ášá¶á”áŸ‹ááŸ‚
            // á¢áŸ’á“á€á…á¼á›ášá½á˜á–á¸ Lesso, HK á“á·á„ Luk Hotpot á”áŸ‰á»ááŸ’ááŸ„áŸ‡ (áŠá€ UC home á…áŸá‰)áŸ”
            // =========================================================================
            
            // 1. Bed Sheet (ID 2) -> Kimteang (u2), Roth (u11)
            if (selectedPrizeId === 2) {
                const kimteang = participants.find(p => p.id === 'u2');
                if (kimteang) winner = kimteang;
                else {
                    const roth = participants.find(p => p.id === 'u11');
                    if (roth) winner = roth;
                }
            }

            // 2. Hotpot set 28$ (ID 5) -> Vanndy (u3)
            if (selectedPrizeId === 5) {
                const vanndy = participants.find(p => p.id === 'u3');
                if (vanndy) winner = vanndy;
            }

            // 3. Toshiba Fan (ID 7) -> Ehong (u6)
            if (selectedPrizeId === 7) {
                const ehong = participants.find(p => p.id === 'u6');
                if (ehong) winner = ehong;
            }

            // 4. $10.00 (ID 8) -> Kimeay (u5), Theavy (u4), Hov (u7)
            if (selectedPrizeId === 8) {
                const kimeay = participants.find(p => p.id === 'u5');
                if (kimeay) winner = kimeay;
                else {
                    const theavy = participants.find(p => p.id === 'u4');
                    if (theavy) winner = theavy;
                    else {
                        const hov = participants.find(p => p.id === 'u7');
                        if (hov) winner = hov;
                    }
                }
            }

            // 5. $20.00 (ID 9) -> Samouern (l1), Horng (l3)
            if (selectedPrizeId === 9) {
                const samouern = participants.find(p => p.id === 'l1');
                if (samouern) winner = samouern;
                else {
                    const horng = participants.find(p => p.id === 'l3');
                    if (horng) winner = horng;
                }
            }

            // 6. $30.00 (ID 10) -> Nin (u8)
            if (selectedPrizeId === 10) {
                const nin = participants.find(p => p.id === 'u8');
                if (nin) winner = nin;
            }

            // --- RANDOM LOGIC (á…á¶á”áŸ‹á…áŸƒáŠá“áŸ’á™áŸá˜áŸ’ášá¶á”áŸ‹ášá„áŸ’áœá¶á“áŸ‹áŠáŸ‚á›á“áŸ…áŸá›áŸ‹) ---
            if (!winner) {
                // Filter out UC Home for random draws
                const eligibleParticipants = participants.filter(p => p.dept !== 'UC home');
                
                if (eligibleParticipants.length > 0) {
                    const finalRandomIndex = Math.floor(Math.random() * eligibleParticipants.length);
                    winner = eligibleParticipants[finalRandomIndex];
                } else {
                    // Fallback if only UC Home left
                    if (participants.length > 0) {
                        const finalRandomIndex = Math.floor(Math.random() * participants.length);
                        winner = participants[finalRandomIndex];
                    }
                }
            }

            return winner;
        }

        function setButtonSpinningState(spinning) {
            if (spinning) {
                drawBtn.classList.add('bg-gray-500/50', 'cursor-wait');
                drawBtn.classList.remove('bg-gradient-to-r', 'from-pink-500', 'to-violet-600', 'hover:from-pink-400', 'hover:to-violet-500', 'hover:shadow-pink-500/50');
                drawBtn.disabled = true;
            } else {
                drawBtn.classList.remove('bg-gray-500/50', 'cursor-wait');
                drawBtn.classList.add('bg-gradient-to-r', 'from-pink-500', 'to-violet-600', 'hover:from-pink-400', 'hover:to-violet-500', 'hover:shadow-pink-500/50');
                drawBtn.disabled = false;
            }
        }

        function handleDraw() {
            if (isSpinning) return;

            const remainingForPrize = getRemainingQty(selectedPrizeId);
            if (remainingForPrize <= 0) {
                showNotification("ášá„áŸ’áœá¶á“áŸ‹á“áŸáŸ‡á¢áŸáŸ‹á á¾á™! áŸá¼á˜á‡áŸ’ášá¾áŸášá¾áŸášá„áŸ’áœá¶á“áŸ‹á•áŸ’áŸáŸá„áŸ”", "error");
                return;
            }

            if (participants.length === 0) {
                showNotification("á¢áŸáŸ‹áˆáŸ’á˜áŸ„áŸ‡á”á»á‚áŸ’á‚á›á·á€á á¾á™!", "error");
                return;
            }

            isSpinning = true;
            winnerDeptEl.classList.add('hidden');
            displayNameEl.textContent = "á€áŸ†á–á»á„á…á¶á”áŸ‹...";
            setButtonSpinningState(true);

            const winner = determineWinnerLogic();
            const currentPrize = prizes.find(p => p.id === selectedPrizeId);

            if (!winner) {
                isSpinning = false;
                showNotification("ášá€á˜á·á“áƒá¾á‰á¢áŸ’á“á€áˆáŸ’á“áŸ‡áŠáŸ‚á›áŸá˜áŸáŸ’ášá”á‘áŸ (á”áŸ’ášá áŸ‚á›á˜á€á–á¸á¢áŸáŸ‹áˆáŸ’á˜áŸ„áŸ‡á€áŸ’á“á»á„á”á‰áŸ’á‡á¸)", "error");
                setButtonSpinningState(false);
                return;
            }

            // --- Calc Spin Angle ---
            const numSlices = participants.length;
            const sliceAngle = 360 / numSlices;
            const winnerIndex = participants.findIndex(p => p.id === winner.id);
            
            // To bring the winning slice to the top (0 deg/ -90 Canvas deg)
            const targetAngle = 360 - ((winnerIndex * sliceAngle) + (sliceAngle / 2));
            
            // Add slight randomness within the slice so it doesn't land perfectly in the center every time
            const randomOffset = (Math.random() - 0.5) * (sliceAngle * 0.7);
            
            // 5 full spins + target angle + random offset
            const spins = 5 * 360; 
            const nextRotation = currentRotation + spins + targetAngle - (currentRotation % 360) + randomOffset;

            // Apply CSS animation
            wheelCanvas.style.transition = `transform 4s cubic-bezier(0.15, 0.85, 0.15, 1)`;
            wheelCanvas.style.transform = `rotate(${nextRotation}deg)`;
            currentRotation = nextRotation;

            setTimeout(() => {
                finishDraw(winner, currentPrize);
            }, 4000); // 4s animation duration
        }

        function finishDraw(winner, currentPrize) {
            isSpinning = false;
            setButtonSpinningState(false);
            
            // Show Winner in the main stage text
            displayNameEl.textContent = winner.name;
            winnerDeptEl.textContent = winner.dept;
            winnerDeptEl.classList.remove('hidden');

            // --- Show Big Winner Modal ---
            bigWinnerName.textContent = winner.name;
            bigWinnerDept.textContent = winner.dept;
            bigWinnerPrizeImg.textContent = currentPrize.image;
            bigWinnerPrizeName.textContent = currentPrize.name;
            
            winnerModal.classList.remove('hidden');
            // Trigger animation
            winnerModalContent.classList.remove('animate-popIn');
            void winnerModalContent.offsetWidth; // trigger reflow
            winnerModalContent.classList.add('animate-popIn');

            // Save winner data
            const newWinner = {
                ...winner,
                prize: currentPrize,
                timestamp: new Date().toLocaleTimeString()
            };

            winners.push(newWinner);
            
            // áŠá€áˆáŸ’á˜áŸ„áŸ‡á¢áŸ’á“á€áˆáŸ’á“áŸ‡á…áŸá‰á–á¸á”á‰áŸ’á‡á¸
            participants = participants.filter(p => p.id !== winner.id);

            renderWinners();
            renderPrizes(); // Update counts
            updateDisplay();
        }

        function closeWinnerModal() {
            winnerModal.classList.add('hidden');
            displayNameEl.textContent = "áŸá¼á˜á…á»á… SPIN";
            winnerDeptEl.classList.add('hidden');
            
            // á›á»áŸ‡ááŸ’ášá¶ááŸ‚á…á»á…á”á·á‘ Modal á‘á¾á”á€á„áœá·á› Reset áŠá¾á˜áŸ’á”á¸á’á¶á“á¶áá¶áˆáŸ’á˜áŸ„áŸ‡ááŸ’á˜á¸ááŸ’ášá¼áœá”á¶á“á‚á¼ášááŸ’ášá¹á˜ááŸ’ášá¼áœ
            wheelCanvas.style.transition = 'none';
            currentRotation = 0;
            wheelCanvas.style.transform = `rotate(0deg)`;
            drawWheel();
        }

        // Reset
        function openResetModal() {
            resetModal.classList.remove('hidden');
        }
        function closeResetModal() {
            resetModal.classList.add('hidden');
        }
        function confirmReset() {
            participants = [...initialParticipants];
            winners = [];
            
            wheelCanvas.style.transition = 'none';
            currentRotation = 0;
            wheelCanvas.style.transform = `rotate(0deg)`;
            drawWheel();
            
            displayNameEl.textContent = "áŸá¼á˜á…á»á… SPIN";
            winnerDeptEl.classList.add('hidden');
            
            closeResetModal();
            showNotification("á‘á·á“áŸ’á“á“áŸá™ááŸ’ášá¼áœá”á¶á“ Reset áŠáŸ„á™á‡áŸ„á‚á‡áŸá™!", "success");
            
            renderPrizes();
            renderWinners();
            updateDisplay();
        }

        // Notification
        function showNotification(message, type = 'error') {
            notifMessage.textContent = message;
            
            if (type === 'error') {
                notifContent.className = 'flex items-center gap-3 px-6 py-4 rounded-xl shadow-2xl border backdrop-blur-md bg-red-500/80 border-red-400 text-white';
            } else {
                notifContent.className = 'flex items-center gap-3 px-6 py-4 rounded-xl shadow-2xl border backdrop-blur-md bg-green-500/80 border-green-400 text-white';
            }

            notificationEl.classList.remove('hidden');
            setTimeout(() => {
                notificationEl.classList.add('hidden');
            }, 3000);
        }

    </script>
</body>
</html>
