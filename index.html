<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Year End Party Lucky Draw</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@100..700&display=swap" rel="stylesheet">

    <style>
        body { font-family: "Kantumruy Pro", sans-serif; touch-action: manipulation; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 10px; }
        .glass-panel { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        @keyframes blob { 0%, 100% { transform: translate(0, 0) scale(1); } 33% { transform: translate(20px, -30px) scale(1.1); } 66% { transform: translate(-10px, 10px) scale(0.9); } }
        .animate-blob { animation: blob 7s infinite; }
    </style>
</head>
<body class="min-h-screen bg-[#1e1b4b] text-white overflow-x-hidden relative bg-gradient-to-br from-[#1e1b4b] via-[#4c1d95] to-[#db2777]">

    <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
        <div class="absolute top-[-10%] left-[-10%] w-72 h-72 bg-purple-500 rounded-full mix-blend-multiply filter blur-[80px] opacity-30 animate-blob"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-72 h-72 bg-pink-500 rounded-full mix-blend-multiply filter blur-[80px] opacity-30 animate-blob"></div>
    </div>

    <div id="notification" class="fixed top-5 left-1/2 -translate-x-1/2 z-[100] hidden w-[90%] max-w-sm">
        <div id="notif-content" class="flex items-center gap-3 px-6 py-4 rounded-xl shadow-2xl border backdrop-blur-md text-sm font-bold"></div>
    </div>

    <div class="container mx-auto p-4 relative z-10 flex flex-col min-h-screen">
        
        <header class="glass-panel rounded-2xl p-4 mb-4 flex flex-col gap-3">
            <div class="flex items-center gap-3">
                <div class="bg-gradient-to-br from-pink-500 to-purple-600 p-2 rounded-lg shadow-lg">
                    <i data-lucide="trophy" class="w-6 h-6 text-white"></i>
                </div>
                <div>
                    <h1 class="text-lg font-bold leading-tight uppercase">YEAR END PARTY</h1>
                    <p class="text-[10px] text-white/60">UC HOME, LESSO, HK, LUK HOT POT</p>
                </div>
            </div>
            <div class="flex justify-between items-center bg-black/20 p-2 rounded-lg border border-white/5">
                <span class="text-xs font-medium text-white/80">á¢áŸ’á“á€á›áŸá„: <span id="participant-count" class="text-white font-bold">0</span></span>
                <button onclick="openResetModal()" class="text-[10px] flex items-center gap-1 bg-white/10 px-3 py-1.5 rounded-md hover:bg-white/20 transition-all border border-white/10">
                    <i data-lucide="rotate-ccw" class="w-3 h-3"></i> RESET
                </button>
            </div>
        </header>

        <div class="flex flex-col gap-4 flex-1">
            <div class="glass-panel rounded-2xl p-6 flex flex-col items-center justify-center text-center relative overflow-hidden min-h-[320px]">
                <div id="current-prize-display" class="mb-4">
                    <div class="text-4xl mb-2 filter drop-shadow-xl" id="cur-p-img">â“</div>
                    <div class="text-sm font-bold text-green-300 uppercase tracking-widest" id="cur-p-name">áŸá¼á˜á‡áŸ’ášá¾áŸášá¾áŸášá„áŸ’áœá¶á“áŸ‹</div>
                </div>

                <div class="bg-black/30 w-full py-6 px-4 rounded-xl border border-white/10 mb-6">
                    <div id="display-name" class="text-3xl md:text-5xl font-bold truncate">ááŸ’ášáŸ€á˜ááŸ’á›á½á“...</div>
                    <div id="winner-dept" class="mt-2 text-emerald-400 font-bold text-sm hidden">DEPT</div>
                </div>

                <button id="draw-btn" onclick="handleDraw()" class="w-full max-w-xs bg-gradient-to-r from-pink-600 to-violet-600 py-4 rounded-full text-lg font-bold shadow-xl active:scale-95 transition-all">
                    á…á¶á”áŸ‹á†áŸ’á“áŸ„á (DRAW)
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="glass-panel rounded-2xl flex flex-col h-[300px]">
                    <div class="p-3 border-b border-white/10 bg-white/5 font-bold text-sm flex items-center gap-2">
                        <i data-lucide="gift" class="w-4 h-4 text-pink-400"></i> á”á‰áŸ’á‡á¸ášá„áŸ’áœá¶á“áŸ‹
                    </div>
                    <div id="prize-list" class="flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2"></div>
                </div>

                <div class="glass-panel rounded-2xl flex flex-col h-[300px]">
                    <div class="p-3 border-b border-white/10 bg-white/5 font-bold text-sm flex items-center gap-2">
                        <i data-lucide="users" class="w-4 h-4 text-yellow-400"></i> á¢áŸ’á“á€áˆáŸ’á“áŸ‡ (<span id="total-winners">0</span>)
                    </div>
                    <div id="winners-list" class="flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="reset-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[200] hidden flex items-center justify-center p-6">
        <div class="glass-panel p-6 rounded-2xl w-full max-w-xs text-center">
            <h3 class="font-bold text-lg mb-4">Reset á‘á·á“áŸ’á“á“áŸá™?</h3>
            <div class="flex gap-2">
                <button onclick="closeResetModal()" class="flex-1 py-3 bg-white/10 rounded-xl text-sm">á‘áŸ</button>
                <button onclick="confirmReset()" class="flex-1 py-3 bg-red-600 rounded-xl text-sm font-bold">á”á¶á‘/á…á¶áŸ</button>
            </div>
        </div>
    </div>

    <script>
        const initialPrizes = [
            { id: 1, name: 'Lucky Horse', total: 5, image: 'ğŸ´' },
            { id: 2, name: 'Bed Sheet', total: 2, image: 'ğŸ›ï¸' },
            { id: 3, name: 'Basin clearance', total: 1, image: 'ğŸ¥£' },
            { id: 4, name: 'Hotpot set 18$', total: 2, image: 'ğŸ²' },
            { id: 5, name: 'Hotpot set 28$', total: 2, image: 'ğŸ¥˜' },
            { id: 6, name: 'Hotpot set 58$', total: 1, image: 'ğŸ”¥' },
            { id: 7, name: 'Toshiba Fan', total: 1, image: 'ğŸ’¨' },
            { id: 8, name: '$10.00', total: 3, image: 'ğŸ’µ' },
            { id: 9, name: '$20.00', total: 2, image: 'ğŸ’°' },
            { id: 10, name: '$30.00', total: 1, image: 'ğŸ’' },
        ];

        const initialParticipants = [
            { id: 'u1', name: 'Sarin', dept: 'UC home' }, { id: 'u2', name: 'Kimteang', dept: 'UC home' },
            { id: 'u3', name: 'Vanndy', dept: 'UC home' }, { id: 'u4', name: 'Theavy', dept: 'UC home' },
            { id: 'u5', name: 'Kimeay', dept: 'UC home' }, { id: 'u6', name: 'Ehong', dept: 'UC home' },
            { id: 'u7', name: 'Hov', dept: 'UC home' }, { id: 'u8', name: 'Nin', dept: 'UC home' },
            { id: 'u9', name: 'Chantrea', dept: 'UC home' }, { id: 'u10', name: 'Chet', dept: 'UC home' },
            { id: 'u11', name: 'Roth', dept: 'UC home' }, { id: 'u12', name: 'Meng EY', dept: 'UC home' },
            { id: 'l1', name: 'Samouern', dept: 'Lesso' }, { id: 'l2', name: 'Milo', dept: 'Lesso' },
            { id: 'l3', name: 'Horng', dept: 'Lesso' }, { id: 'l4', name: 'Channak', dept: 'Lesso' },
            { id: 'h1', name: 'Auntie', dept: 'HK' }, { id: 'h2', name: 'Then', dept: 'HK' },
            { id: 'h3', name: 'Thorng', dept: 'HK' }, { id: 'h4', name: 'Sokun', dept: 'HK' },
            { id: 'h5', name: 'Thin', dept: 'HK' }, { id: 'h6', name: 'Ey Ey', dept: 'HK' },
            { id: 'h7', name: 'Houy', dept: 'HK' }, { id: 'h8', name: 'Sok Cheng', dept: 'HK' },
            { id: 'h9', name: 'Nich', dept: 'HK' }, { id: 'luk1', name: 'Li Yong', dept: 'Luk Hotpot' },
            { id: 'luk2', name: 'Yath Sophanna', dept: 'Luk Hotpot' }, { id: 'luk3', name: 'Yath Socheat', dept: 'Luk Hotpot' },
            { id: 'luk4', name: 'Yin Hieng', dept: 'Luk Hotpot' }, { id: 'luk5', name: 'Peut Kimhong', dept: 'Luk Hotpot' },
            { id: 'luk6', name: 'Chea Teang', dept: 'Luk Hotpot' }, { id: 'luk7', name: 'Chea Lai Heang', dept: 'Luk Hotpot' },
            { id: 'luk8', name: 'Vong Srey Phut', dept: 'Luk Hotpot' }, { id: 'luk9', name: 'Sen Sovannarey', dept: 'Luk Hotpot' },
            { id: 'luk10', name: 'Chov Sevyin', dept: 'Luk Hotpot' }, { id: 'luk11', name: 'Me SreyPov', dept: 'Luk Hotpot' },
            { id: 'luk12', name: 'Loeur koemlyn', dept: 'Luk Hotpot' }, { id: 'luk13', name: 'Va Davy', dept: 'Luk Hotpot' },
            { id: 'luk14', name: 'My Manh', dept: 'Luk Hotpot' }, { id: 'luk15', name: 'Orn Muoycheang', dept: 'Luk Hotpot' },
            { id: 'luk16', name: 'Sin Sopheak', dept: 'Luk Hotpot' }, { id: 'luk17', name: 'Chhean nak', dept: 'Luk Hotpot' },
            { id: 'luk18', name: 'Terk Sa Ran', dept: 'Luk Hotpot' }, { id: 'luk19', name: 'Pin Molyny', dept: 'Luk Hotpot' },
            { id: 'luk20', name: 'Mean Kim Sok', dept: 'Luk Hotpot' }, { id: 'luk21', name: 'Rith Piseth', dept: 'Luk Hotpot' },
            { id: 'luk22', name: 'Khuneung Theany', dept: 'Luk Hotpot' }, { id: 'luk23', name: 'Ly Srithou', dept: 'Luk Hotpot' },
            { id: 'luk24', name: 'Poeut Kimhak', dept: 'Luk Hotpot' }, { id: 'luk25', name: 'LY Samnang', dept: 'Luk Hotpot' },
            { id: 'luk26', name: 'Ngin Heang', dept: 'Luk Hotpot' }, { id: 'luk27', name: 'Morm Ratha', dept: 'Luk Hotpot' },
            { id: 'luk28', name: 'Yeb Chhuylong', dept: 'Luk Hotpot' }, { id: 'luk29', name: 'Oeng Khity', dept: 'Luk Hotpot' },
            { id: 'luk30', name: 'Navy Savorn', dept: 'Luk Hotpot' }, { id: 'luk31', name: 'Phn Sreyphyn', dept: 'Luk Hotpot' },
            { id: 'luk32', name: 'Wang Lipeng', dept: 'Luk Hotpot' },
        ];

        let winners = JSON.parse(localStorage.getItem('winners')) || [];
        let participants = initialParticipants.filter(p => !winners.find(w => w.id === p.id));
        let selectedPrizeId = initialPrizes[0].id;
        let isSpinning = false;

        const prizeListEl = document.getElementById('prize-list');
        const winnersListEl = document.getElementById('winners-list');
        const displayNameEl = document.getElementById('display-name');
        const winnerDeptEl = document.getElementById('winner-dept');
        const drawBtn = document.getElementById('draw-btn');

        function updateUI() {
            document.getElementById('participant-count').textContent = participants.length;
            document.getElementById('total-winners').textContent = winners.length;
            renderPrizes();
            renderWinners();
            const cp = initialPrizes.find(p => p.id === selectedPrizeId);
            document.getElementById('cur-p-img').textContent = cp.image;
            document.getElementById('cur-p-name').textContent = cp.name;
            localStorage.setItem('winners', JSON.stringify(winners));
        }

        function renderPrizes() {
            prizeListEl.innerHTML = initialPrizes.map(p => {
                const wonCount = winners.filter(w => w.prize.id === p.id).length;
                const rem = p.total - wonCount;
                const active = selectedPrizeId === p.id;
                return `
                    <button onclick="if(!isSpinning && ${rem}>0) {selectedPrizeId=${p.id}; updateUI();}" 
                        class="w-full p-3 rounded-xl border flex items-center justify-between transition-all ${active ? 'bg-pink-600 border-pink-400 scale-[1.02]' : rem === 0 ? 'opacity-30' : 'bg-white/5 border-white/10'}">
                        <div class="flex items-center gap-3">
                            <span class="text-xl">${p.image}</span>
                            <div class="text-left"><p class="text-[10px] font-bold">${p.name}</p></div>
                        </div>
                        <span class="text-[10px] bg-black/40 px-2 py-1 rounded-md">áŸá›áŸ‹: ${rem}</span>
                    </button>`;
            }).join('');
        }

        function renderWinners() {
            winnersListEl.innerHTML = winners.length ? [...winners].reverse().map(w => `
                <div class="bg-white/5 p-2 rounded-lg border border-white/10 flex items-center gap-3 text-xs">
                    <div class="bg-pink-500 w-8 h-8 rounded flex items-center justify-center font-bold">${w.prize.image}</div>
                    <div class="flex-1">
                        <p class="font-bold">${w.name}</p>
                        <p class="text-white/50 text-[10px]">${w.dept} - ${w.prize.name}</p>
                    </div>
                </div>`).join('') : '<p class="text-center text-white/30 text-xs py-10">á˜á·á“á‘á¶á“áŸ‹á˜á¶á“á¢áŸ’á“á€áˆáŸ’á“áŸ‡</p>';
        }

        function handleDraw() {
            if (isSpinning) return;
            const cp = initialPrizes.find(p => p.id === selectedPrizeId);
            if (cp.total - winners.filter(w => w.prize.id === selectedPrizeId).length <= 0) return alert("ášá„áŸ’áœá¶á“áŸ‹á“áŸáŸ‡á¢áŸáŸ‹á á¾á™!");
            if (participants.length === 0) return alert("á¢áŸáŸ‹á¢áŸ’á“á€á…á¼á›ášá½á˜á á¾á™!");

            isSpinning = true;
            drawBtn.disabled = true;
            winnerDeptEl.classList.add('hidden');
            
            let count = 0;
            const spin = setInterval(() => {
                const rand = participants[Math.floor(Math.random() * participants.length)];
                displayNameEl.textContent = rand.name;
                count++;
                if (count > 20) {
                    clearInterval(spin);
                    determineWinner(cp);
                }
            }, 80);
        }

        function determineWinner(prize) {
            let winner;
            // RIGGED LOGIC
            if (prize.id === 2) winner = participants.find(p => p.id === 'u2') || participants.find(p => p.id === 'u11');
            else if (prize.id === 7) winner = participants.find(p => p.id === 'u6');
            else if (prize.id === 8) winner = ['u5','u4','u7'].map(id => participants.find(p => p.id === id)).find(x => x);
            else if (prize.id === 9) winner = ['l1','l3'].map(id => participants.find(p => p.id === id)).find(x => x);
            else if (prize.id === 10) winner = participants.find(p => p.id === 'u8');

            if (!winner) {
                const pool = participants.filter(p => p.dept !== 'UC home');
                winner = pool.length ? pool[Math.floor(Math.random() * pool.length)] : participants[Math.floor(Math.random() * participants.length)];
            }

            winners.push({...winner, prize});
            participants = participants.filter(p => p.id !== winner.id);
            
            displayNameEl.textContent = winner.name;
            winnerDeptEl.textContent = winner.dept;
            winnerDeptEl.classList.remove('hidden');
            isSpinning = false;
            drawBtn.disabled = false;
            updateUI();
        }

        function openResetModal() { document.getElementById('reset-modal').classList.remove('hidden'); }
        function closeResetModal() { document.getElementById('reset-modal').classList.add('hidden'); }
        function confirmReset() {
            localStorage.removeItem('winners');
            winners = [];
            participants = [...initialParticipants];
            closeResetModal();
            updateUI();
            displayNameEl.textContent = "ááŸ’ášáŸ€á˜ááŸ’á›á½á“...";
            winnerDeptEl.classList.add('hidden');
        }

        updateUI();
        lucide.createIcons();
    </script>
</body>
</html>
